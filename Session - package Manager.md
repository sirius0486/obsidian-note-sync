## node_modules

### ä¾èµ–åµŒå¥—ğŸª†
npm2 çš„ node_modules æ˜¯åµŒå¥—çš„ï¼Œ å¤šä¸ªåŒ…ä¹‹é—´éš¾å…ä¼šæœ‰å…¬å…±çš„ä¾èµ–ï¼Œè¿™æ ·åµŒå¥—çš„è¯ï¼ŒåŒæ ·çš„ä¾èµ–ä¼šå¤åˆ¶å¾ˆå¤šæ¬¡ï¼Œè¿™ç›´æ¥å¯¼è‡´ç£ç›˜ç©ºé—´çš„æ€¥é€Ÿè†¨èƒ€, ç›´è§‚çš„æ„Ÿå—å°±æ˜¯`npm install`çš„æ—¶å€™éœ€è¦ç­‰å¾…éå¸¸é•¿çš„æ—¶é—´ï¼Œæˆ–è€…è¶…æ—¶ï¼ŒåŒæ—¶åƒæ‰ä½ ä¸€éƒ¨åˆ†çš„ç£ç›˜ç©ºé—´ï¼ˆç”šè‡³ä»¥GBä¸ºå•ä½ğŸ˜­ï¼‰ 

é™¤æ­¤ä¹‹å¤–å¯¼è‡´çš„ä¸€ä¸ªæœ€è‡´å‘½é—®é¢˜æ˜¯ `windows` çš„æ–‡ä»¶è·¯å¾„æœ€é•¿æ˜¯ 260 å¤šä¸ªå­—ç¬¦ï¼Œè¿™æ ·åµŒå¥—æ˜¯ä¼šè¶…è¿‡ windows è·¯å¾„çš„é•¿åº¦é™åˆ¶çš„ã€‚

### åµŒå¥—æ‹å¹³ï¼ˆæ‰å¹³åŒ–ï¼‰å’Œ locke é”æ–‡ä»¶
å½“æ—¶npmå¹¶æ²¡æœ‰è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥yarnå°±è¯ç”Ÿå‡ºæ¥å¹¶è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”npmåœ¨éšåçš„ç‰ˆæœ¬ä¸­ä¹Ÿè·Ÿè¿›äº†è¿™ä¸ªfeture. (btw, locké”æ–‡ä»¶å¯ä»¥é”å®šä¾èµ–ç‰ˆæœ¬ä¹Ÿæ˜¯yarnæœ€å…ˆå®ç°çš„ï¼Œnpmä¹Ÿåœ¨éšåè·Ÿè¿›äº†)


### å¹½çµä¾èµ–ğŸ‘»
ä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆå¹¶æ²¡æœ‰å®Œå…¨è§£å†³é—®é¢˜ï¼Œæ‰å¹³åŒ–çš„æ–¹æ¡ˆä¹Ÿæœ‰ç›¸åº”çš„é—®é¢˜ã€‚

æœ€ä¸»è¦çš„ä¸€ä¸ªé—®é¢˜æ˜¯å¹½çµä¾èµ–ï¼Œä¹Ÿå°±æ˜¯ä½ æ˜æ˜æ²¡æœ‰å£°æ˜åœ¨ dependencies é‡Œçš„ä¾èµ–ï¼Œä½†åœ¨ä»£ç é‡Œå´å¯ä»¥ require è¿›æ¥ã€‚

è¿™ä¸ªä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œå› ä¸ºéƒ½é“ºå¹³äº†å˜›ï¼Œé‚£ä¾èµ–çš„ä¾èµ–ä¹Ÿæ˜¯å¯ä»¥æ‰¾åˆ°çš„ã€‚

ä½†æ˜¯è¿™æ ·æ˜¯æœ‰éšæ‚£çš„ï¼Œå› ä¸ºæ²¡æœ‰æ˜¾å¼ä¾èµ–ï¼Œä¸‡ä¸€æœ‰ä¸€å¤©åˆ«çš„åŒ…ä¸ä¾èµ–è¿™ä¸ªåŒ…äº†ï¼Œé‚£ä½ çš„ä»£ç ä¹Ÿå°±ä¸èƒ½è·‘äº†ï¼Œå› ä¸ºä½ ä¾èµ–è¿™ä¸ªåŒ…ï¼Œä½†æ˜¯ç°åœ¨ä¸ä¼šè¢«å®‰è£…äº†ã€‚

è¿™å°±æ˜¯å¹½çµä¾èµ–çš„é—®é¢˜ã€‚

è€Œä¸”è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä¸Šé¢æåˆ°çš„ä¾èµ–åŒ…æœ‰å¤šä¸ªç‰ˆæœ¬çš„æ—¶å€™ï¼Œåªä¼šæå‡ä¸€ä¸ªï¼Œé‚£å…¶ä½™ç‰ˆæœ¬çš„åŒ…ä¸è¿˜æ˜¯å¤åˆ¶äº†å¾ˆå¤šæ¬¡ä¹ˆï¼Œä¾ç„¶æœ‰æµªè´¹ç£ç›˜ç©ºé—´çš„é—®é¢˜ã€‚

### pnpm
pnpm æ˜¯ä¸€ä¸ª Node.js åŒ…ç®¡ç†å™¨ï¼Œå®ƒå¯ä»¥ç”¨æ¥ä»£æ›¿ npm æˆ– Yarnã€‚pnpm æ”¯æŒ Monorepoï¼Œå¯ä»¥é€šè¿‡ `pnpm-workspace.yaml` æ–‡ä»¶åœ¨å¤šä¸ªå­é¡¹ç›®ä¹‹é—´å…±äº«ä¾èµ–é¡¹ã€‚pnpm çš„ monorepo ç‰¹æ€§å’Œ Yarn Workspacesã€Lerna ç±»ä¼¼ï¼Œéƒ½æ˜¯ä¸ºäº†è§£å†³å¤šä¸ªç›¸å…³é¡¹ç›®å…±äº«ä»£ç å’Œä¾èµ–é¡¹çš„é—®é¢˜ã€‚

pnpm é€šè¿‡å…±äº«ä¾èµ–æ¥å‡å°‘ç£ç›˜ç©ºé—´çš„ä½¿ç”¨ï¼Œå¹¶ä¸”é€šè¿‡å¹¶è¡Œå®‰è£…ä¾èµ–é¡¹æ¥æé«˜å®‰è£…é€Ÿåº¦ã€‚

ã€‚å®ƒç”± npm/yarn è¡ç”Ÿè€Œæ¥ï¼Œä½†å´è§£å†³äº† npm/yarn å†…éƒ¨æ½œåœ¨çš„ bugï¼Œå¹¶ä¸”æå¤§äº†åœ°ä¼˜åŒ–äº†æ€§èƒ½ï¼Œæ‰©å±•äº†ä½¿ç”¨åœºæ™¯ã€‚

ä»¥ä¸‹æ˜¯ pnpm çš„ä¸€äº›ä¼˜ç¼ºç‚¹ï¼š

ä¼˜ç‚¹ï¼š

-   ç£ç›˜ç©ºé—´ä½¿ç”¨æ›´å°‘ï¼špnpm é€šè¿‡å…±äº«ä¾èµ–é¡¹æ¥å‡å°‘ç£ç›˜ç©ºé—´çš„ä½¿ç”¨ã€‚å¦‚æœå¤šä¸ªé¡¹ç›®éƒ½ä½¿ç”¨äº†åŒä¸€ä¸ªä¾èµ–é¡¹ï¼Œé‚£ä¹ˆè¿™ä¸ªä¾èµ–é¡¹åªä¼šè¢«ä¸‹è½½ä¸€æ¬¡ï¼Œå¹¶ä¸”è¢«å…±äº«åˆ°è¿™äº›é¡¹ç›®ä¸­ã€‚
-   æ›´å¿«çš„å®‰è£…é€Ÿåº¦ï¼špnpm æ”¯æŒå¹¶è¡Œå®‰è£…ä¾èµ–é¡¹ï¼Œè¿™æ ·å¯ä»¥æ›´å¿«åœ°å®Œæˆå®‰è£…ã€‚pnpm è¿˜å¯ä»¥ç¼“å­˜å·²ç»å®‰è£…çš„ä¾èµ–é¡¹ï¼Œè¿™æ ·å¯ä»¥é¿å…é‡å¤ä¸‹è½½ã€‚
-   æ›´å¥½çš„ monorepo æ”¯æŒï¼špnpm æ”¯æŒ monorepo ç¯å¢ƒï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å…±äº«ä¾èµ–é¡¹æ¥å‡å°‘é‡å¤çš„å®‰è£…ã€‚è¿™æ ·å¯ä»¥ä½¿ monorepo ç¯å¢ƒæ›´åŠ é«˜æ•ˆã€‚

1.  **å®‰è£…é€Ÿåº¦æœ€å¿«**ï¼ˆéæ‰å¹³çš„åŒ…ç»“æ„ï¼Œæ²¡æœ‰`yarn/npm`çš„å¤æ‚çš„æ‰å¹³ç®—æ³•ï¼Œä¸”åªæ›´æ–°å˜åŒ–çš„æ–‡ä»¶ï¼‰
2.  **èŠ‚çœç£ç›˜ç©ºé—´**Â ï¼ˆç»Ÿä¸€å®‰è£…åŒ…åˆ°ç£ç›˜çš„æŸä¸ªä½ç½®ï¼Œé¡¹ç›®ä¸­çš„`node_modules`é€šè¿‡`hard-link`çš„æ–¹å¼é“¾æ¥åˆ°å®é™…çš„å®‰è£…åœ°å€ï¼‰

ç¼ºç‚¹ï¼š

-   ç›¸å¯¹è¾ƒæ–°ï¼špnpm æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ–°çš„åŒ…ç®¡ç†å™¨ï¼Œç›¸å¯¹äº npm å’Œ Yarn æ¥è¯´è¿˜æ²¡æœ‰é‚£ä¹ˆæˆç†Ÿå’Œç¨³å®šã€‚å¯èƒ½å­˜åœ¨æŸäº›ä¸å…¼å®¹æˆ–è€… bugã€‚
-   å¯èƒ½éœ€è¦ä¸€äº›é…ç½®ï¼špnpm åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¯èƒ½éœ€è¦ä¸€äº›é¢å¤–çš„é…ç½®ï¼Œä»¥ä¾¿æ›´å¥½åœ°æ”¯æŒ monorepo ç¯å¢ƒæˆ–è€…ä¸å…¶ä»–å·¥å…·ååŒä½¿ç”¨ã€‚



### Monorepo
å¦‚æœä½ æ‰“ç®—æŠŠå‰åç«¯éƒ½æ”¾åœ¨åŒä¸€ä¸ª repo é‡Œé¢ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ monorepo å·¥å…·æ¥
è¿›è¡Œä¾èµ–ç®¡ç†å’Œå¤ç”¨ã€‚

monorepo æ˜¯æŒ‡å°†å¤šä¸ªç›¸å…³çš„é¡¹ç›®ï¼ˆå¦‚å‰ç«¯ã€åç«¯ã€æµ‹è¯•ç­‰ï¼‰æ”¾åœ¨ä¸€ä¸ªä»“åº“ä¸­è¿›è¡Œç®¡ç†ï¼Œé€šè¿‡å…±äº«ä¾èµ–æ¥æé«˜å¼€å‘æ•ˆç‡å’Œä»£ç å¯ç»´æŠ¤æ€§ã€‚åœ¨ monorepo ä¸­ï¼Œå¯ä»¥å°†å…±äº«çš„ä»£ç æˆ–åº“æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„ç›®å½•ä¸­ï¼Œå¹¶åœ¨å„ä¸ªå­é¡¹ç›®ä¸­å¼•ç”¨å®ƒä»¬ï¼Œé¿å…äº†é‡å¤çš„ä»£ç å’Œä¾èµ–ç®¡ç†ã€‚

ä¸€äº›å¸¸ç”¨çš„ monorepo å·¥å…·åŒ…æ‹¬ï¼š

-   Lernaï¼šä¸€ä¸ª JavaScript å·¥å…·ï¼Œç”¨äºç®¡ç†å…·æœ‰å¤šä¸ªè½¯ä»¶åŒ…çš„ JavaScript é¡¹ç›®çš„å·¥ä½œæµç¨‹ã€‚
-   Yarn Workspacesï¼šYarn è‡ªå¸¦çš„ monorepo å·¥å…·ï¼Œå¯ä»¥å°†å¤šä¸ªé¡¹ç›®å…±äº«ä¾èµ–å’Œé…ç½®ã€‚
-   Nxï¼šä¸€ä¸ªé›†æˆäº† Lerna å’Œ Yarn Workspaces çš„ monorepo å·¥å…·ï¼Œç”¨äºæ„å»ºå’Œæµ‹è¯• Angularã€React å’Œ Node.js åº”ç”¨ã€‚

ä½¿ç”¨ monorepo å¯ä»¥ç®€åŒ–é¡¹ç›®çš„ç®¡ç†å’Œç»´æŠ¤ï¼Œå¹¶ä¸”æé«˜ä»£ç å¤ç”¨æ€§ã€‚


å½“ä¸€ä¸ªé¡¹ç›®åŒ…å«å¤šä¸ªç‹¬ç«‹ä½†ç›¸å…³çš„ç»„ä»¶æ—¶ï¼Œmonorepoæ˜¯ä¸€ç§ç»„ç»‡å’Œç®¡ç†ä»£ç çš„æ–¹æ³•ã€‚å®ƒå…è®¸å°†è¿™äº›ç»„ä»¶ç»Ÿä¸€æ”¾åœ¨ä¸€ä¸ªç‰ˆæœ¬æ§åˆ¶åº“ä¸­ï¼Œä»è€Œç®€åŒ–äº†åä½œå’Œå…±äº«ä»£ç çš„è¿‡ç¨‹ã€‚

å…·ä½“æ¥è¯´ï¼Œmonorepoæ˜¯ä¸€ä¸ªå•ä¸€çš„ä»£ç åº“ï¼Œå…¶ä¸­åŒ…å«å¤šä¸ªé¡¹ç›®æˆ–åŒ…ã€‚æ¯ä¸ªé¡¹ç›®æˆ–åŒ…éƒ½å¯ä»¥æœ‰è‡ªå·±çš„ç›®å½•ç»“æ„ã€é…ç½®å’Œä¾èµ–é¡¹ï¼Œä½†å®ƒä»¬å…±äº«ç›¸åŒçš„ç‰ˆæœ¬æ§åˆ¶å’Œæ„å»º/éƒ¨ç½²æµç¨‹ã€‚è¿™æ„å‘³ç€å¦‚æœä½ éœ€è¦ä¿®æ”¹ä¸€ä¸ªç»„ä»¶ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°æ‰¾åˆ°å®ƒï¼Œå¹¶ä¸”å¯ä»¥åœ¨åŒä¸€ä¸ªæäº¤ä¸­ä¿®æ”¹å¤šä¸ªç»„ä»¶ã€‚

Monorepoçš„ä¼˜ç‚¹åŒ…æ‹¬ï¼š

-   ä»£ç å…±äº«ï¼šå¤šä¸ªé¡¹ç›®æˆ–åŒ…å¯ä»¥å…±äº«ä»£ç ï¼Œä»è€Œå‡å°‘äº†ä»£ç çš„é‡å¤ç¼–å†™ï¼Œæé«˜äº†ä»£ç è´¨é‡å’Œä¸€è‡´æ€§ã€‚
-   æ›´å¥½çš„å¯ç»´æŠ¤æ€§ï¼šæ‰€æœ‰ä»£ç éƒ½åœ¨åŒä¸€ä¸ªç‰ˆæœ¬æ§åˆ¶åº“ä¸­ï¼Œä¾¿äºä»£ç é‡æ„ã€è¿ç§»å’Œç»´æŠ¤ã€‚
-   æ›´å¥½çš„åä½œï¼šå¤šä¸ªå¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­åˆä½œå¼€å‘ï¼Œå…±äº«ä»£ç å’ŒçŸ¥è¯†ã€‚
-   æ›´å¿«çš„æ„å»ºå’Œæµ‹è¯•ï¼šå¯ä»¥åœ¨ä¸€ä¸ªä»£ç åº“ä¸­ç»Ÿä¸€ç®¡ç†å’Œæ„å»ºæ‰€æœ‰ç»„ä»¶ï¼Œä»è€Œæé«˜äº†æ„å»ºå’Œæµ‹è¯•çš„æ•ˆç‡ã€‚

å½“ç„¶ï¼Œmonorepoå¹¶ä¸é€‚ç”¨äºæ‰€æœ‰æƒ…å†µã€‚å¦‚æœä½ çš„é¡¹ç›®éå¸¸å¤§æˆ–è€…åŒ…å«éå¸¸ä¸ç›¸å…³çš„ç»„ä»¶ï¼Œé‚£ä¹ˆåˆ†ç¦»æˆå¤šä¸ªåº“å¯èƒ½æ›´å¥½ã€‚

#### ç¼ºç‚¹ï¼š
ç¼–è¯‘/ ä¾èµ–å®‰è£…æ—¶é—´å˜é•¿  ->  æŒ‰éœ€ç¼–è¯‘/ æ‰‹åŠ¨æŒ‡å®šç¼–è¯‘é¡¹ç›®
Gitè®°å½•æ··ä¹± -> æ‰€æœ‰äººçš„commitéƒ½åœ¨ä¸€ä¸ªçº¿æ€§å†å²ï¼Œ éœ€è¦å›¢é˜Ÿçš„è§„èŒƒåŒ–å¤„ç†ï¼Œåšå¥½git commitæ£€éªŒ
é¡¹ç›®éšç§æ€§ -> å¦‚æœéœ€è¦å¯¹æŸäº›ä»“åº“è¿›è¡Œæƒé™ç®¡ç†å°±éœ€è¦æ…ç”¨äº†ï¼Œ å®ç°ä¸äº†å¯¹æŸä¸ªé¡¹ç›®æ–½åŠ ç»†ç²’åº¦çš„æƒé™æ§åˆ¶
å¯¹IDEè´Ÿæ‹…åŠ é‡ï¼Œ åŠ è½½å‡ åä¸ªé¡¹ç›®çš„ä»£ç éœ€è¦ä¸€ç‚¹æ—¶é—´å’Œä¸€ç‚¹ç‚¹å†…å­˜

### example


> ä½¿ç”¨`pnpm`ç®¡ç†çš„ä¸€ä¸ª`monorepo`ä¾‹å­

```json
your-monorepo/  
â”œâ”€â”€ package-a/  
â”‚   â”œâ”€â”€ package.json  
â”‚   â”œâ”€â”€ node_modules/  
â”‚   â”œâ”€â”€ package-a/  
â”‚   â”‚   â”œâ”€â”€ index.js  
â”‚   â”‚   â”œâ”€â”€ main.js  
â”‚   â”‚   â”œâ”€â”€ package-a.js  
â”‚   â”‚   â”œâ”€â”€ package-a-global.js  
â”‚   â”œâ”€â”€ package-b/  
â”‚   â”‚   â”œâ”€â”€ package.json  
â”‚   â”‚   â”œâ”€â”€ node_modules/  
â”‚   â”‚   â”œâ”€â”€ package-b/  
â”‚   â”‚   â”‚   â”œâ”€â”€ index.js  
â”‚   â”‚   â”‚   â”œâ”€â”€ main.js  
â”‚   â”‚   â”‚   â”œâ”€â”€ package-b.js  
â”‚   â”‚   â”‚   â”œâ”€â”€ package-b-global.js  
â”œâ”€â”€ package-c/  
â”‚   â”œâ”€â”€ package.json  
â”‚   â”œâ”€â”€ node_modules/  
â”‚   â”œâ”€â”€ package-c/  
â”‚   â”‚   â”œâ”€â”€ index.js  
â”‚   â”‚   â”œâ”€â”€ main.js  
â”‚   â”‚   â”œâ”€â”€ package-c.js  
â”‚   â”‚   â”œâ”€â”€ package-c-global.js  
â”œâ”€â”€ package-d/  

```

è¿™ä¸ªç¤ºä¾‹ monorepo åŒ…å«å¤šä¸ªåŒ…ï¼Œæ¯ä¸ªåŒ…éƒ½æœ‰è‡ªå·±çš„ `package.json` æ–‡ä»¶å’Œè‡ªå·±çš„ node_modules ç›®å½•ã€‚æ­¤å¤–ï¼Œæ¯ä¸ªåŒ…è¿˜æ‹¥æœ‰ä¸€äº›å…±åŒçš„ä¾èµ–é¡¹ï¼Œè¿™äº›ä¾èµ–é¡¹å­˜å‚¨åœ¨å…±åŒçš„ node_modules ç›®å½•ä¸­ã€‚

ä½¿ç”¨ pnpmï¼Œå¼€å‘äººå‘˜å¯ä»¥åœ¨å•ä¸ªå‘½ä»¤ä¸­å®‰è£…æ•´ä¸ª monorepoï¼Œå¹¶è‡ªåŠ¨å®‰è£…æ‰€æœ‰ä¾èµ–é¡¹ã€‚æ­¤å¤–ï¼Œç”±äº pnpm ä½¿ç”¨ç¼“å­˜ï¼Œå› æ­¤å®‰è£…è¿‡ç¨‹éå¸¸å¿«ï¼Œå¹¶ä¸”å¯ä»¥èŠ‚çœç£ç›˜ç©ºé—´



####  è§£å†³é—®é¢˜
- è§£å†³ä»£ç å¤ç”¨é—®é¢˜
- å¼€å‘æµç¨‹ç»Ÿä¸€
- é«˜æ•ˆç®¡ç†å¤šé¡¹ç›®/åŒ…ï¼Œ èŠ‚çœä»£ç ä½“ç§¯



### å‚è€ƒé“¾æ¥
1. https://juejin.cn/post/7184392660939964474?share_token=53ea67e2-d1c6-45e4-ad90-ec26b139e8ca
2. https://juejin.cn/post/6932046455733485575
3. https://juejin.cn/post/7099090192887185439?share_token=1e47d0b5-9dc0-45e6-95ab-3d475212d132
4. https://zhuanlan.zhihu.com/p/77577415